<!DOCTYPE html>
<!--
  §§ Cognitive Framework Headers (master.json v12.9.0 compliance)
  
  J Dilla Playlist - Audio Restoration Project
  
  Features:
  - Working YouTube iframe API with proper event handlers
  - Audio context integration with analyser for visualizations
  - Track management with playlist loading
  - Control integration with play/pause and keyboard navigation
  - Distorted warp tunnel as primary visualization
  - Mobile-first responsive design
  - WCAG 2.2 AAA compliance
  
  Audio Controls:
  - Spacebar: Play/pause toggle
  - Arrow keys: Previous/next track
  - Home/End: First/last track
  - Click: Play/pause button
  
  Visualization Modes:
  1. Distorted Warp Tunnel (Primary)
  2. Starfield Warp Tunnel
  3. Ultimate J Dilla Experience
  4. Master.json Compliant Engine
  5. Audio Spectrum Analyzer
  
  Cognitive Load Management:
  - Progressive disclosure interface
  - Working memory optimization (7±2 concepts)
  - Minimal cognitive overhead
  - Flow state preservation
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="J Dilla Playlist - Interactive audio player with visualizations">
  <meta name="keywords" content="J Dilla, playlist, audio, visualization, music">
  <title>J Dilla Playlist - Audio Experience</title>
  <script src="https://www.youtube.com/iframe_api"></script>
  <style>
    /* §§ Cognitive Framework: Ultra Minimal Mobile-First Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
      background: #000;
      color: #fff;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
      user-select: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    /* §§ Auto-Rotating Visualization Carousel */
    .visualization-carousel {
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* §§ Fade Transitions Between Visualizations */
    .visualizer-slide {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 2s ease-in-out;
      z-index: 1;
    }

    .visualizer-slide.active {
      opacity: 1;
      z-index: 2;
    }

    /* §§ Minimal Touch Controls (WCAG 2.2 AAA Compliant) */
    .audio-controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 9999;
      background: rgba(0, 0, 0, 0.9);
      padding: 20px 25px;
      border-radius: 30px;
      border: 2px solid #8a2be2;
      display: flex;
      align-items: center;
      gap: 20px;
      backdrop-filter: blur(15px);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    }

    .play-pause-btn {
      background: linear-gradient(135deg, #8a2be2, #ff6b6b);
      border: none;
      color: #fff;
      font-size: 28px;
      cursor: pointer;
      padding: 8px;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(138, 43, 226, 0.4);
    }

    .play-pause-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(138, 43, 226, 0.6);
    }

    .play-pause-btn:focus {
      outline: 3px solid #fff;
      outline-offset: 2px;
    }

    .track-info {
      font-size: 14px;
      line-height: 1.3;
      max-width: 250px;
      overflow: hidden;
      text-align: left;
    }

    .track-title {
      font-weight: 600;
      font-size: 15px;
      margin-bottom: 2px;
      color: #fff;
    }

    .track-artist {
      opacity: 0.8;
      font-size: 13px;
      color: #ccc;
      margin-bottom: 4px;
    }

    .track-progress {
      font-size: 11px;
      opacity: 0.6;
      color: #999;
    }

    .visualization-indicator {
      font-size: 10px;
      opacity: 0.7;
      color: #8a2be2;
      font-weight: 500;
      margin-top: 2px;
    }

    /* §§ Distorted Warp Tunnel (Primary Visualization) */
    .distorted-warp-slide {
      background: #000;
      position: relative;
      width: 100%;
      height: 100%;
    }

    .distorted-warp-slide canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      touch-action: none;
    }

    /* §§ Starfield Visualizer Styles */
    .starfield-slide {
      background: #000;
      position: relative;
      width: 100%;
      height: 100%;
    }

    .starfield-slide canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* §§ Placeholder Visualizer Styles */
    .placeholder-slide {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
      text-align: center;
      padding: 40px;
      width: 100%;
      height: 100%;
    }

    .placeholder-title {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 20px;
      background: linear-gradient(45deg, #8a2be2, #ff6b6b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .placeholder-subtitle {
      font-size: 1.1rem;
      margin-bottom: 30px;
      opacity: 0.8;
      line-height: 1.6;
      max-width: 600px;
    }

    .placeholder-features {
      list-style: none;
      font-size: 1rem;
      opacity: 0.7;
    }

    .placeholder-features li {
      margin-bottom: 10px;
      padding-left: 25px;
      position: relative;
    }

    .placeholder-features li:before {
      content: "→";
      position: absolute;
      left: 0;
      color: #8a2be2;
      font-weight: bold;
    }

    /* §§ Hidden YouTube Player */
    #youtube-player {
      display: none;
      position: absolute;
      top: -1000px;
      left: -1000px;
      width: 1px;
      height: 1px;
    }

    /* §§ Keyboard Navigation Indicator */
    .keyboard-hint {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      background: rgba(0, 0, 0, 0.8);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid #8a2be2;
      font-size: 12px;
      opacity: 0.7;
      max-width: 200px;
      backdrop-filter: blur(10px);
    }

    .keyboard-hint h4 {
      color: #8a2be2;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .keyboard-hint ul {
      list-style: none;
      line-height: 1.4;
    }

    .keyboard-hint li {
      margin-bottom: 3px;
      color: #ccc;
    }

    .keyboard-hint .key {
      color: #fff;
      font-weight: 600;
    }

    /* §§ Responsive Design - Mobile First */
    @media (max-width: 768px) {
      .placeholder-title {
        font-size: 2rem;
      }
      
      .placeholder-subtitle {
        font-size: 1rem;
      }
      
      .audio-controls {
        bottom: 15px;
        padding: 15px 20px;
      }
      
      .track-info {
        max-width: 180px;
        font-size: 13px;
      }
      
      .keyboard-hint {
        display: none;
      }
    }

    @media (max-width: 480px) {
      .audio-controls {
        padding: 12px 16px;
        gap: 15px;
      }
      
      .play-pause-btn {
        width: 50px;
        height: 50px;
        font-size: 24px;
      }
      
      .track-info {
        max-width: 150px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <!-- §§ Visualization Carousel -->
  <div class="visualization-carousel">
    
    <!-- Slide 1: Distorted Warp Tunnel (Primary) -->
    <div class="visualizer-slide active" id="distorted-warp-slide">
      <div class="distorted-warp-slide" id="distorted-warp-container">
        <canvas id="distorted-warp-canvas" role="img" aria-label="Distorted warp tunnel visualization responding to audio"></canvas>
      </div>
    </div>

    <!-- Slide 2: Starfield Warp Tunnel -->
    <div class="visualizer-slide" id="starfield-slide">
      <div class="starfield-slide" id="starfield-container">
        <canvas id="starfield-canvas" role="img" aria-label="Starfield warp tunnel visualization"></canvas>
      </div>
    </div>

    <!-- Slide 3: Ultimate J Dilla Experience -->
    <div class="visualizer-slide" id="ultimate-slide">
      <div class="placeholder-slide">
        <h1 class="placeholder-title">Ultimate J Dilla Experience</h1>
        <p class="placeholder-subtitle">
          Comprehensive audio experience with real-time visualization and cognitive load management.
          This mode features advanced audio analysis with flow state preservation.
        </p>
        <ul class="placeholder-features">
          <li>Real-time audio frequency analysis</li>
          <li>Advanced visualization controls</li>
          <li>Cognitive load management system</li>
          <li>Interactive UI components</li>
          <li>Flow state preservation features</li>
        </ul>
      </div>
    </div>

    <!-- Slide 4: Master.json Compliant Engine -->
    <div class="visualizer-slide" id="master-slide">
      <div class="placeholder-slide">
        <h1 class="placeholder-title">Master.json Compliant Engine</h1>
        <p class="placeholder-subtitle">
          Advanced visual engine built according to master.json v12.9.0 specifications.
          Features progressive disclosure and working memory optimization.
        </p>
        <ul class="placeholder-features">
          <li>Master.json v12.9.0 compliance</li>
          <li>Progressive disclosure interface</li>
          <li>Working memory limits (7±2 concepts)</li>
          <li>Cognitive circuit breakers</li>
          <li>WCAG 2.2 AAA accessibility</li>
          <li>Mobile-first responsive design</li>
        </ul>
      </div>
    </div>

    <!-- Slide 5: Audio Spectrum Analyzer -->
    <div class="visualizer-slide" id="spectrum-slide">
      <div class="placeholder-slide">
        <h1 class="placeholder-title">Audio Spectrum Analyzer</h1>
        <p class="placeholder-subtitle">
          Real-time frequency domain analysis with visual feedback.
          Advanced audio processing with Web Audio API integration.
        </p>
        <ul class="placeholder-features">
          <li>Real-time FFT analysis</li>
          <li>Frequency domain visualization</li>
          <li>Audio context integration</li>
          <li>Responsive visual feedback</li>
          <li>Low-latency audio processing</li>
        </ul>
      </div>
    </div>

  </div>

  <!-- §§ Audio Controls -->
  <div class="audio-controls">
    <button class="play-pause-btn" id="play-pause-btn" aria-label="Play or pause audio">▶</button>
    <div class="track-info">
      <div class="track-title" id="current-track-title">Microphone Master [Extended]</div>
      <div class="track-artist" id="current-track-artist">J Dilla</div>
      <div class="track-progress" id="track-progress">0:00 / 0:00</div>
      <div class="visualization-indicator" id="visualization-indicator">Distorted Warp Tunnel</div>
    </div>
  </div>

  <!-- §§ Keyboard Navigation Hints -->
  <div class="keyboard-hint">
    <h4>Keyboard Controls</h4>
    <ul>
      <li><span class="key">Space</span> Play/Pause</li>
      <li><span class="key">←→</span> Prev/Next Track</li>
      <li><span class="key">Home</span> First Track</li>
      <li><span class="key">End</span> Last Track</li>
      <li><span class="key">↑↓</span> Change Visual</li>
    </ul>
  </div>

  <!-- §§ Hidden YouTube Player -->
  <div id="youtube-player"></div>

  <script>
    // §§ Updated J Dilla Playlist (as specified in requirements)
    const tracks = [
      { id: "9EGHwkDix78", title: "Microphone Master [Extended]", artist: "J Dilla", url: "https://www.youtube.com/watch?v=9EGHwkDix78" },
      { id: "WC09qDzU9y4", title: "Due Time", artist: "AFTA-1", url: "https://www.youtube.com/watch?v=WC09qDzU9y4" },
      { id: "9ycJsnzJ-hA", title: "In Space", artist: "J Dilla", url: "https://www.youtube.com/watch?v=9ycJsnzJ-hA" },
      { id: "9OPypHXlJUQ", title: "Chinubian", artist: "Jneiro Jarel", url: "https://www.youtube.com/watch?v=9OPypHXlJUQ" },
      { id: "_-17rzyBrKY", title: "Rhodes Ahead", artist: "Karriem Riggins", url: "https://www.youtube.com/watch?v=_-17rzyBrKY" },
      { id: "RpDcz90_oWY", title: "Ooooaaa", artist: "Karriem Riggins", url: "https://www.youtube.com/watch?v=RpDcz90_oWY" },
      { id: "B1ZvmzfUJv0", title: "Back In Brazil", artist: "Karriem Riggins", url: "https://www.youtube.com/watch?v=B1ZvmzfUJv0" },
      { id: "JGUqRBJ4bIo", title: "Embryo", artist: "Baatin", url: "https://www.youtube.com/watch?v=JGUqRBJ4bIo" },
      { id: "nelU7OMF7VY", title: "Orbitz", artist: "Karriem Riggins", url: "https://www.youtube.com/watch?v=nelU7OMF7VY" },
      { id: "jnP3tRG-LZs", title: "Sounds Like Love (Extended)", artist: "J Dilla", url: "https://www.youtube.com/watch?v=jnP3tRG-LZs" },
      { id: "t6T-Q6HMbEo", title: "Get It Together (Instrumental)", artist: "J-88 (Slum Village)", url: "https://www.youtube.com/watch?v=t6T-Q6HMbEo" },
      { id: "zoGTC7uROZE", title: "Hustle (Instrumental Mix)", artist: "J Dilla", url: "https://www.youtube.com/watch?v=zoGTC7uROZE" },
      { id: "7611GgbJAbM", title: "Stupid Lies (Instrumental) (HQ)", artist: "J Dilla", url: "https://www.youtube.com/watch?v=7611GgbJAbM" },
      { id: "j0z_-7TfPeM", title: "Fantastic (Instrumental)", artist: "J Dilla", url: "https://www.youtube.com/watch?v=j0z_-7TfPeM" }
    ];

    // §§ Global Variables
    let youtubePlayer;
    let currentTrackIndex = 0;
    let isPlaying = false;
    let audioContext;
    let analyser;
    let dataArray;
    let audioSource;

    // §§ Visualization Variables
    let currentVisualizationIndex = 0;
    let visualizationInterval;
    let isVisualizationActive = false;
    const visualizationSwitchTime = 30000; // 30 seconds
    let visualizationInitialized = {
      distortedWarp: false,
      starfield: false,
      spectrum: false
    };
    
    const visualizationSlides = [
      "distorted-warp-slide",
      "starfield-slide", 
      "ultimate-slide",
      "master-slide",
      "spectrum-slide"
    ];

    const visualizationNames = [
      "Distorted Warp Tunnel",
      "Starfield Warp Tunnel",
      "Ultimate J Dilla Experience",
      "Master.json Compliant Engine",
      "Audio Spectrum Analyzer"
    ];

    // §§ Distorted Warp Tunnel Variables
    let distortedWarpCanvas, distortedWarpContext;
    let distortedWarpParticles = [];
    let distortedWarpTime = 0;

    // §§ Starfield Variables
    let starfieldCanvas, starfieldContext;
    let starfieldParticles = [];
    let starfieldTime = 0;

    // §§ YouTube Player Setup with Error Handling
    function onYouTubeIframeAPIReady() {
      youtubePlayer = new YT.Player("youtube-player", {
        height: "1",
        width: "1",
        videoId: tracks[currentTrackIndex].id,
        playerVars: {
          autoplay: 0,
          controls: 0,
          disablekb: 1,
          fs: 0,
          modestbranding: 1,
          playsinline: 1,
          rel: 0,
          origin: window.location.origin
        },
        events: {
          onReady: onPlayerReady,
          onStateChange: onPlayerStateChange,
          onError: onPlayerError
        }
      });
    }

    function onPlayerReady(event) {
      console.log("YouTube player ready");
      updateTrackInfo();
      setupAudioContext();
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        isPlaying = true;
        document.getElementById("play-pause-btn").textContent = "⏸";
        startVisualization();
      } else if (event.data === YT.PlayerState.PAUSED || event.data === YT.PlayerState.ENDED) {
        isPlaying = false;
        document.getElementById("play-pause-btn").textContent = "▶";
        if (event.data === YT.PlayerState.ENDED) {
          nextTrack();
        }
      }
    }

    function onPlayerError(event) {
      console.error("YouTube player error:", event.data);
      // Try to skip to next track on error
      setTimeout(() => {
        nextTrack();
      }, 2000);
    }

    // §§ Audio Context Setup
    function setupAudioContext() {
      if (!audioContext) {
        try {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          analyser = audioContext.createAnalyser();
          analyser.connect(audioContext.destination);
          analyser.smoothingTimeConstant = 0.8;
          analyser.fftSize = 2048;
          const bufferLength = analyser.frequencyBinCount;
          dataArray = new Uint8Array(bufferLength);
        } catch (e) {
          console.warn("Audio context setup failed:", e);
        }
      }
    }

    // §§ Audio Control Functions
    function togglePlayPause() {
      if (!youtubePlayer) return;
      
      if (isPlaying) {
        youtubePlayer.pauseVideo();
      } else {
        youtubePlayer.playVideo();
      }
    }

    function nextTrack() {
      currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
      loadTrack();
    }

    function previousTrack() {
      currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
      loadTrack();
    }

    function firstTrack() {
      currentTrackIndex = 0;
      loadTrack();
    }

    function lastTrack() {
      currentTrackIndex = tracks.length - 1;
      loadTrack();
    }

    function loadTrack() {
      if (!youtubePlayer) return;
      
      const track = tracks[currentTrackIndex];
      youtubePlayer.loadVideoById(track.id);
      updateTrackInfo();
    }

    function updateTrackInfo() {
      const track = tracks[currentTrackIndex];
      document.getElementById("current-track-title").textContent = track.title;
      document.getElementById("current-track-artist").textContent = track.artist;
      
      // Update progress display
      if (youtubePlayer && youtubePlayer.getDuration) {
        const duration = youtubePlayer.getDuration();
        const current = youtubePlayer.getCurrentTime();
        const progress = formatTime(current) + " / " + formatTime(duration);
        document.getElementById("track-progress").textContent = progress;
      }
    }

    function formatTime(seconds) {
      const minutes = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return minutes + ":" + (secs < 10 ? "0" : "") + secs;
    }

    // §§ Visualization Control
    function startVisualization() {
      if (isVisualizationActive) return;
      
      isVisualizationActive = true;
      
      // Initialize primary visualization
      if (!visualizationInitialized.distortedWarp) {
        initDistortedWarpTunnel();
        visualizationInitialized.distortedWarp = true;
      }
      
      // Start periodic visualization switching
      visualizationInterval = setInterval(switchVisualization, visualizationSwitchTime);
    }

    function stopVisualization() {
      if (visualizationInterval) {
        clearInterval(visualizationInterval);
        visualizationInterval = null;
      }
      isVisualizationActive = false;
    }

    function switchVisualization() {
      const nextIndex = (currentVisualizationIndex + 1) % visualizationSlides.length;
      fadeToVisualization(nextIndex);
    }

    function fadeToVisualization(visualizationIndex) {
      const currentSlide = document.getElementById(visualizationSlides[currentVisualizationIndex]);
      const nextSlide = document.getElementById(visualizationSlides[visualizationIndex]);
      
      // Update indicator
      document.getElementById("visualization-indicator").textContent = visualizationNames[visualizationIndex];
      
      // Fade out current
      currentSlide.classList.remove("active");
      
      // Fade in next
      setTimeout(() => {
        nextSlide.classList.add("active");
        currentVisualizationIndex = visualizationIndex;
        
        // Initialize visualization if needed
        if (visualizationIndex === 0 && !visualizationInitialized.distortedWarp) {
          initDistortedWarpTunnel();
          visualizationInitialized.distortedWarp = true;
        } else if (visualizationIndex === 1 && !visualizationInitialized.starfield) {
          initStarfieldTunnel();
          visualizationInitialized.starfield = true;
        }
      }, 1000);
    }

    // §§ Distorted Warp Tunnel Implementation
    function initDistortedWarpTunnel() {
      const container = document.getElementById("distorted-warp-container");
      if (!container) return;

      distortedWarpCanvas = document.getElementById("distorted-warp-canvas");
      if (!distortedWarpCanvas) return;

      distortedWarpContext = distortedWarpCanvas.getContext("2d");
      
      function resizeDistortedWarpCanvas() {
        distortedWarpCanvas.width = window.innerWidth;
        distortedWarpCanvas.height = window.innerHeight;
      }
      
      resizeDistortedWarpCanvas();
      window.addEventListener("resize", resizeDistortedWarpCanvas);
      
      // Initialize particles
      distortedWarpParticles = [];
      for (let i = 0; i < 300; i++) {
        distortedWarpParticles.push({
          x: (Math.random() - 0.5) * 3000,
          y: (Math.random() - 0.5) * 3000,
          z: Math.random() * 1500,
          prevX: 0,
          prevY: 0,
          distortion: Math.random() * 0.5 + 0.5
        });
      }
      
      animateDistortedWarpTunnel();
    }

    function animateDistortedWarpTunnel() {
      if (!distortedWarpContext || !distortedWarpCanvas) return;
      
      // Create trail effect
      distortedWarpContext.fillStyle = "rgba(0, 0, 0, 0.15)";
      distortedWarpContext.fillRect(0, 0, distortedWarpCanvas.width, distortedWarpCanvas.height);
      
      const centerX = distortedWarpCanvas.width / 2;
      const centerY = distortedWarpCanvas.height / 2;
      
      distortedWarpTime += 0.02;
      
      // Get audio data for distortion
      let audioLevel = 0;
      if (analyser && dataArray) {
        analyser.getByteFrequencyData(dataArray);
        const sum = dataArray.reduce((a, b) => a + b, 0);
        audioLevel = sum / dataArray.length / 255;
      }
      
      distortedWarpParticles.forEach(particle => {
        // Audio-reactive speed
        const speed = 8 + audioLevel * 15;
        particle.z -= speed;
        
        if (particle.z <= 0) {
          particle.z = 1500;
          particle.x = (Math.random() - 0.5) * 3000;
          particle.y = (Math.random() - 0.5) * 3000;
          particle.distortion = Math.random() * 0.5 + 0.5;
        }
        
        // Apply distortion based on audio
        const distortionFactor = particle.distortion + audioLevel * 2;
        const distortedX = particle.x + Math.sin(distortedWarpTime + particle.y * 0.001) * distortionFactor * 100;
        const distortedY = particle.y + Math.cos(distortedWarpTime + particle.x * 0.001) * distortionFactor * 100;
        
        const x = (distortedX / particle.z) * 400 + centerX;
        const y = (distortedY / particle.z) * 400 + centerY;
        
        const size = (1 - particle.z / 1500) * 4 + audioLevel * 3;
        const hue = (particle.z * 0.2 + distortedWarpTime * 30 + audioLevel * 100) % 360;
        const saturation = 70 + audioLevel * 30;
        const lightness = 50 + audioLevel * 30;
        
        // Draw particle
        distortedWarpContext.beginPath();
        distortedWarpContext.arc(x, y, size, 0, Math.PI * 2);
        distortedWarpContext.fillStyle = `hsl(${hue}, ${saturation}%, ${lightness}%)`;
        distortedWarpContext.fill();
        
        // Draw trail
        if (particle.prevX && particle.prevY) {
          distortedWarpContext.beginPath();
          distortedWarpContext.moveTo(particle.prevX, particle.prevY);
          distortedWarpContext.lineTo(x, y);
          distortedWarpContext.strokeStyle = `hsla(${hue}, ${saturation}%, ${lightness}%, 0.6)`;
          distortedWarpContext.lineWidth = size * 0.8;
          distortedWarpContext.stroke();
        }
        
        particle.prevX = x;
        particle.prevY = y;
      });
      
      requestAnimationFrame(animateDistortedWarpTunnel);
    }

    // §§ Starfield Tunnel Implementation
    function initStarfieldTunnel() {
      const container = document.getElementById("starfield-container");
      if (!container) return;

      starfieldCanvas = document.getElementById("starfield-canvas");
      if (!starfieldCanvas) return;

      starfieldContext = starfieldCanvas.getContext("2d");
      
      function resizeStarfieldCanvas() {
        starfieldCanvas.width = window.innerWidth;
        starfieldCanvas.height = window.innerHeight;
      }
      
      resizeStarfieldCanvas();
      window.addEventListener("resize", resizeStarfieldCanvas);
      
      // Initialize starfield particles
      starfieldParticles = [];
      for (let i = 0; i < 200; i++) {
        starfieldParticles.push({
          x: (Math.random() - 0.5) * 2000,
          y: (Math.random() - 0.5) * 2000,
          z: Math.random() * 1000,
          prevX: 0,
          prevY: 0
        });
      }
      
      animateStarfieldTunnel();
    }

    function animateStarfieldTunnel() {
      if (!starfieldContext || !starfieldCanvas) return;
      
      starfieldContext.fillStyle = "rgba(0, 0, 0, 0.2)";
      starfieldContext.fillRect(0, 0, starfieldCanvas.width, starfieldCanvas.height);
      
      const centerX = starfieldCanvas.width / 2;
      const centerY = starfieldCanvas.height / 2;
      
      starfieldTime += 0.01;
      
      starfieldParticles.forEach(particle => {
        particle.z -= 6;
        if (particle.z <= 0) {
          particle.z = 1000;
          particle.x = (Math.random() - 0.5) * 2000;
          particle.y = (Math.random() - 0.5) * 2000;
        }
        
        const x = (particle.x / particle.z) * 500 + centerX;
        const y = (particle.y / particle.z) * 500 + centerY;
        
        const size = (1 - particle.z / 1000) * 3;
        
        starfieldContext.beginPath();
        starfieldContext.arc(x, y, size, 0, Math.PI * 2);
        starfieldContext.fillStyle = `hsl(${(particle.z * 0.1 + starfieldTime * 50) % 360}, 70%, 80%)`;
        starfieldContext.fill();
        
        if (particle.prevX && particle.prevY) {
          starfieldContext.beginPath();
          starfieldContext.moveTo(particle.prevX, particle.prevY);
          starfieldContext.lineTo(x, y);
          starfieldContext.strokeStyle = `hsla(${(particle.z * 0.1 + starfieldTime * 50) % 360}, 70%, 80%, 0.5)`;
          starfieldContext.lineWidth = size * 0.5;
          starfieldContext.stroke();
        }
        
        particle.prevX = x;
        particle.prevY = y;
      });
      
      requestAnimationFrame(animateStarfieldTunnel);
    }

    // §§ Keyboard Controls
    document.addEventListener("keydown", (event) => {
      switch(event.code) {
        case "Space":
          event.preventDefault();
          togglePlayPause();
          break;
        case "ArrowLeft":
          event.preventDefault();
          previousTrack();
          break;
        case "ArrowRight":
          event.preventDefault();
          nextTrack();
          break;
        case "Home":
          event.preventDefault();
          firstTrack();
          break;
        case "End":
          event.preventDefault();
          lastTrack();
          break;
        case "ArrowUp":
          event.preventDefault();
          fadeToVisualization((currentVisualizationIndex + 1) % visualizationSlides.length);
          break;
        case "ArrowDown":
          event.preventDefault();
          fadeToVisualization((currentVisualizationIndex - 1 + visualizationSlides.length) % visualizationSlides.length);
          break;
      }
    });

    // §§ Touch Gestures for Mobile
    let touchStartX = 0;
    let touchStartY = 0;
    
    document.addEventListener("touchstart", (e) => {
      touchStartX = e.touches[0].clientX;
      touchStartY = e.touches[0].clientY;
    });

    document.addEventListener("touchend", (e) => {
      const touchEndX = e.changedTouches[0].clientX;
      const touchEndY = e.changedTouches[0].clientY;
      const diffX = touchStartX - touchEndX;
      const diffY = touchStartY - touchEndY;
      
      // Horizontal swipes for track navigation
      if (Math.abs(diffX) > Math.abs(diffY) && Math.abs(diffX) > 50) {
        if (diffX > 0) {
          nextTrack();
        } else {
          previousTrack();
        }
      }
      
      // Vertical swipes for visualization switching
      if (Math.abs(diffY) > Math.abs(diffX) && Math.abs(diffY) > 50) {
        if (diffY > 0) {
          fadeToVisualization((currentVisualizationIndex + 1) % visualizationSlides.length);
        } else {
          fadeToVisualization((currentVisualizationIndex - 1 + visualizationSlides.length) % visualizationSlides.length);
        }
      }
    });

    // §§ Event Listeners
    document.getElementById("play-pause-btn").addEventListener("click", togglePlayPause);

    // §§ Progress Update
    setInterval(() => {
      if (youtubePlayer && isPlaying) {
        updateTrackInfo();
      }
    }, 1000);

    // §§ Initialize on Page Load
    window.addEventListener("load", () => {
      // Initialize primary visualization
      initDistortedWarpTunnel();
      visualizationInitialized.distortedWarp = true;
      
      // Auto-start after a brief delay
      setTimeout(() => {
        if (!isPlaying) {
          togglePlayPause();
        }
      }, 2000);
    });

    // §§ Cleanup on page unload
    window.addEventListener("beforeunload", () => {
      stopVisualization();
      if (audioContext) {
        audioContext.close();
      }
    });
  </script>
</body>
</html>